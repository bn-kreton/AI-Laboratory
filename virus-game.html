<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Virus Hunter | ØµØ§Ø¦Ø¯ Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; 
            background: #050507; 
            color: white; 
            font-family: 'Cairo', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
        .game-title {
            color: #d4af37;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
            letter-spacing: 2px;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .ui-container {
            width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 5px;
            padding: 0 10px;
        }

        .stats-left { text-align: right; color: #d4af37; font-size: 1.2rem; }
        .stats-right { text-align: left; color: #ffef00; font-size: 1.2rem; }
        .hp-text { color: #ff4d4d; font-weight: bold; }

        canvas { 
            border: 2px solid #d4af37; 
            background: rgba(10, 10, 15, 0.95);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>

    <h1 class="game-title">VIRUS HUNTER</h1>

    <div class="ui-container">
        <div class="stats-left">
            <div class="hp-text">HP: <span id="hpValue">5</span></div>
            <div>Score: <span id="scoreValue">0</span></div>
        </div>
        
        <div class="stats-right">
            Ø§Ù„ÙˆÙ‚Øª: <span id="timerValue">0</span>s
        </div>
    </div>
        <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø¯Ø¡ -->
        <div id="startScreen" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5, 5, 7, 0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100;">
        <h2 style="color: #d4af37; font-size: 2.5rem; margin-bottom: 20px;">Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø­Ù…Ø§ÙŠØ©ØŸ</h2>
        <button onclick="startGame()" style="padding: 15px 40px; font-size: 1.5rem; background: transparent; color: #d4af37; border: 2px solid #d4af37; border-radius: 10px; cursor: pointer; font-family: 'Cairo'; transition: 0.3s;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
        <p style="color: #a0a0a0; margin-top: 20px;">Ø§Ù„ØªØ­Ø±Ùƒ: A, D Ø£Ùˆ Ø§Ù„Ø£Ø³Ù‡Ù… | Ø¥Ø·Ù„Ø§Ù‚: Space | Ø§Ù†Ø¯ÙØ§Ø¹: Ù†Ù‚Ø±Ø© Ù…Ø²Ø¯ÙˆØ¬Ø©</p>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 500; // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†

        let score = 0; let hp = 7; let secondsElapsed = 0;
        let gameActive = false; let difficultyFactor = 0;

        function startGame() {
            document.getElementById('startScreen').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            gameActive = true;
            spawnEnemy(); // Ø¨Ø¯Ø¡ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
            draw(); // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø³Ù…
        }


        const player = {
            x: canvas.width / 2 - 20,
            y: canvas.height - 60,
            size: 40,
            speed: 4,
            dashDistance: 70
        };

        let lastLeftTime = 0;
        let lastRightTime = 0;
        const doubleTapThreshold = 300; // Ù†Øµ Ø«Ø§Ù†ÙŠØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ (300-500ms)

        const bullets = [];
        const enemies = [];
        const keys = {};

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±
        window.addEventListener('keydown', e => {
            // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            if (e.repeat) return; 

            keys[e.code] = true;

            // Dash Ù„Ù„ÙŠØ³Ø§Ø±
            if (e.code === 'KeyA' || e.code === 'ArrowLeft') {
                let currentTime = Date.now();
                if (currentTime - lastLeftTime < doubleTapThreshold) {
                    player.x -= player.dashDistance;
                }
                lastLeftTime = currentTime;
            }

            // Dash Ù„Ù„ÙŠÙ…ÙŠÙ†
            if (e.code === 'KeyD' || e.code === 'ArrowRight') {
                let currentTime = Date.now();
                if (currentTime - lastRightTime < doubleTapThreshold) {
                    player.x += player.dashDistance;
                }
                lastRightTime = currentTime;
            }
        });

        window.addEventListener('keyup', e => keys[e.code] = false);

        // Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª
        setInterval(() => {
            if (gameActive) {
                secondsElapsed++;
                document.getElementById('timerValue').innerText = secondsElapsed;
                difficultyFactor = secondsElapsed * 0.05; 

                // Ø´Ø±Ø· Ø§Ù„ÙÙˆØ² Ø¹Ù†Ø¯ 60 Ø«Ø§Ù†ÙŠØ©
                if (secondsElapsed >= 53) {
                    gameWin();
                }
            }
        }, 1000);

        function spawnEnemy() {
            if(!gameActive) return;

            // 1. ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø¨ÙŠÙ† 20 Ùˆ 50 Ø¨ÙƒØ³Ù„)
            let randomSize = Math.floor(Math.random() * (50 - 20 + 1)) + 20;

            // 2. ØªØ­Ø¯ÙŠØ¯ Ø³Ø±Ø¹Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ù…: Ø§Ù„ØµØºÙŠØ± Ø£Ø³Ø±Ø¹ ÙˆØ§Ù„ÙƒØ¨ÙŠØ± Ø£Ø¨Ø·Ø£ Ù‚Ù„ÙŠÙ„Ø§Ù‹)
            // Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© + Ø¹Ø§Ù…Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ + Ø¹Ø§Ù…Ù„ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø²Ù…Ù†ÙŠ
            let baseSpeed = 1 + difficultyFactor;
            let randomSpeed = baseSpeed + (Math.random() * 1); 
            if (randomSize < 30) randomSpeed += 0.1; // Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ ØªØ£Ø®Ø° Ø¯ÙØ¹Ø© Ø³Ø±Ø¹Ø© Ø¥Ø¶Ø§ÙÙŠØ©

            // 3. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ù‚Ø§Ø· (Score) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ù… Ø£Ùˆ Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø¨ÙŠÙ† 10 Ùˆ 20)
            let randomScoreValue = Math.floor(Math.random() * (20 - 10 + 1)) + 10;

            enemies.push({
                x: Math.random() * (canvas.width - randomSize),
                y: -50,
                size: randomSize,
                speed: randomSpeed,
                scoreValue: randomScoreValue // ØªØ®Ø²ÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø¯Ø§Ø®Ù„ ÙƒØ§Ø¦Ù† Ø§Ù„ÙÙŠØ±ÙˆØ³
            });

            let spawnRate = Math.max(400, 1600 - (secondsElapsed * 15));
            setTimeout(spawnEnemy, spawnRate);
        }

        function update() {
            if(!gameActive) return;

            if ((keys['ArrowLeft'] || keys['KeyA']) && player.x > 0) player.x -= player.speed;
            if ((keys['ArrowRight'] || keys['KeyD']) && player.x < canvas.width - player.size) player.x += player.speed;

            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.size) player.x = canvas.width - player.size;

            if (keys['Space']) {
                if(bullets.length === 0 || bullets[bullets.length-1].y < canvas.height - 120) {
                    bullets.push({ x: player.x + player.size/2, y: player.y, speed: 9 });
                }
            }

            bullets.forEach((b, i) => {
                b.y -= b.speed;
                if(b.y < 0) bullets.splice(i, 1);
            });

            enemies.forEach((en, i) => {
                en.y += en.speed;
                
                // ØªØµØ§Ø¯Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø¹ Ø§Ù„ÙÙŠØ±ÙˆØ³ (ÙŠÙ†Ù‚Øµ Ø¯Ù… ÙÙˆØ±Ø§Ù‹)
                if (player.x < en.x + en.size && player.x + player.size > en.x &&
                    player.y < en.y + en.size && player.y + player.size > en.y) {
                    enemies.splice(i, 1);
                    decreaseHP();
                }

                // Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ Ø¯Ø§Ø®Ù„ Ø¯Ø§Ù„Ø© update ÙˆÙ‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„Ù‡:
                bullets.forEach((b, bi) => {
                    if(b.x > en.x && b.x < en.x + en.size && b.y < en.y + en.size && b.y > en.y) {
                        score += en.scoreValue; // Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ±ÙˆØ³ ØªØ­Ø¯ÙŠØ¯Ø§Ù‹
                        enemies.splice(i, 1);
                        bullets.splice(bi, 1);
                        document.getElementById('scoreValue').innerText = score;
                    }
                });

                if(en.y > canvas.height) {
                    enemies.splice(i, 1);
                    decreaseHP();
                }
            });
        }

        function decreaseHP() {
            hp--;
            document.getElementById('hpValue').innerText = hp;
            if(hp <= 0) gameOver();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ù…Ø±ÙƒØ¨Ø© Ø°Ù‡Ø¨ÙŠØ©)
            ctx.fillStyle = "#d4af37";
            ctx.beginPath();
            ctx.moveTo(player.x + player.size/2, player.y);
            ctx.lineTo(player.x, player.y + player.size);
            ctx.lineTo(player.x + player.size, player.y + player.size);
            ctx.fill();

            // Ø±Ø³Ù… Ø§Ù„Ø±ØµØ§Øµ
            ctx.fillStyle = "#00ffff";
            bullets.forEach(b => ctx.fillRect(b.x-2, b.y, 4, 15));

            // Ø±Ø³Ù… Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª
            enemies.forEach(en => {
                ctx.fillStyle = "#ff4d4d";
                ctx.beginPath();
                ctx.arc(en.x + en.size/2, en.y + en.size/2, en.size/2, 0, Math.PI*2);
                ctx.fill();
            });

            requestAnimationFrame(() => { update(); draw(); });
        }

        function gameOver() {
            gameActive = false;
            alert("âš ï¸ ØªÙ€Ù… Ø§Ø®Ù€ØªÙ€Ø±Ø§Ù‚ Ø§Ù„Ù€Ù†Ù€Ø¸Ù€Ø§Ù…! \nØ§Ù„Ù†Ù‚Ø§Ø·: " + score + "\nØ§Ù„ØµÙ…ÙˆØ¯: " + secondsElapsed + " Ø«Ø§Ù†ÙŠØ©");
            location.reload();
        }

        function gameWin() {
            gameActive = false;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            alert("ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ø§Ù„Ù‚Ø¶Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ÙŠØ±ÙˆØ³ Ø¨Ù†Ø¬Ø§Ø­ ğŸ†\n\n" + 
                "ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:\n" +
                "------------------\n" +
                "ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·: " + score + "\n" +
                "â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: " + secondsElapsed + " Ø«Ø§Ù†ÙŠØ©\n" +
                "â¤ï¸ Ø§Ù„ØµØ­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: " + hp);
            location.reload(); 
        }

    </script>
</body>
</html>